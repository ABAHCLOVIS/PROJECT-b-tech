<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="../css/dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:18px;">
      <button id="notification-btn" style="background:none;border:none;position:relative;font-size:22px;cursor:pointer;margin-right:18px;" aria-label="Show notifications">ðŸ””<span id="notif-dot" style="display:inline-block;width:8px;height:8px;background:#f44336;border-radius:50%;position:absolute;top:2px;right:2px;"></span></button>
      <button id="hamburger" aria-label="Toggle sidebar" aria-expanded="false" style="background:none;border:none;font-size:24px;cursor:pointer;">&#9776;</button>
      <button class="profile-btn">Profile</button>
      <button class="logout-btn" onclick="logoutRedirect()">Logout</button>
    </div>
  </div>
  <div class="sidebar">
    <a href="#" class="sidebar-link active">Dashboard</a>
    <a href="course-management.html" class="sidebar-link">Manage Courses</a>
    <a href="file-upload.html" class="sidebar-link">Upload Materials</a>
    <a href="profile.html" class="sidebar-link">Profile</a>
    <a href="#" class="sidebar-link" id="open-chat-btn">Chat</a>
    <a href="manage-users.html" class="sidebar-link">Manage Users</a>
  </div>
  <div class="main-content">
    <!-- Notification Panel (left side, dynamic, single instance) -->
    <div id="notification-panel" style="display:none;position:fixed;top:70px;left:30px;width:360px;max-width:97vw;z-index:3000;background:#fff;box-shadow:0 4px 24px rgba(0,0,0,0.18);border-radius:12px;overflow:hidden;">
      <div style="background:#3949ab;color:#fff;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:600;font-size:1.1rem;">Notifications</span>
        <button id="close-notif-btn" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">&times;</button>
      </div>
      <div id="notif-list" style="max-height:340px;overflow-y:auto;padding:0;"></div>
      <div style="padding:10px 18px;border-top:1px solid #eee;background:#fafafa;display:flex;gap:8px;">
        <input id="notif-title" type="text" placeholder="Title" style="flex:1;padding:6px 8px;border-radius:5px;border:1px solid #ccc;font-size:14px;">
        <input id="notif-msg" type="text" placeholder="Message" style="flex:2;padding:6px 8px;border-radius:5px;border:1px solid #ccc;font-size:14px;">
        <button id="add-notif-btn" style="background:#3949ab;color:#fff;border:none;padding:6px 14px;border-radius:5px;font-weight:600;">Add</button>
      </div>
    </div>
    <!-- Manage Users Modal -->
    <h2>Admin Dashboard</h2>
    <div style="display:flex;gap:24px;flex-wrap:wrap;">
      <div class="card" style="flex:1;min-width:200px;">
        <h3>Total Students</h3>
        <p id="total-students">120</p>
      </div>
      <div class="card" style="flex:1;min-width:200px;">
        <h3>Total Courses</h3>
        <p id="total-courses">15</p>
      </div>
      <div class="card" style="flex:1;min-width:200px;">
        <h3>Uploaded Materials</h3>
        <p id="total-materials">45</p>
      </div>
    </div>



    <!-- WhatsApp-like Chat Modal -->
    <div id="chat-modal" style="display:none;position:fixed;right:0;bottom:0;width:350px;max-width:95vw;height:480px;z-index:2000;background:#fff;box-shadow:-2px 0 16px rgba(0,0,0,0.18);border-radius:16px 0 0 0;flex-direction:column;overflow:hidden;">
      <div style="background:#075e54;color:#fff;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;">
        <span style="font-weight:600;font-size:1.1rem;">HUIB Chat</span>
        <button id="close-chat-btn" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">&times;</button>
      </div>
      <div id="chat-box" style="flex:1;height:340px;overflow-y:auto;background:#ece5dd;padding:14px 10px 14px 10px;font-size:15px;display:flex;flex-direction:column;gap:8px;"></div>
      <form id="chat-form" style="display:flex;gap:6px;padding:10px;background:#f7f7f7;border-top:1px solid #ddd;">
        <input id="chat-user" type="text" placeholder="Your name" required style="flex:1;min-width:80px;padding:7px 10px;border-radius:5px;border:1px solid #ccc;">
        <input id="chat-msg" type="text" placeholder="Type a message..." required style="flex:2;min-width:120px;padding:7px 10px;border-radius:5px;border:1px solid #ccc;">
        <button type="submit" style="background:#25d366;color:#fff;border:none;padding:7px 16px;border-radius:5px;font-weight:600;">Send</button>
      </form>
    </div>
    <div class="card">
      <h3>Enrollment Stats</h3>
      <canvas id="enrollmentChart" width="400" height="120"></canvas>
    </div>
    <div class="card">
      <h3>Recent Student Registrations</h3>
      <table style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="background:#fbc02d;color:#1a237e;">
            <th>Name</th><th>Email</th><th>Department</th><th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Jane Doe</td><td>jane@example.com</td><td>CS</td><td>2025-06-30</td></tr>
          <tr><td>John Smith</td><td>john@example.com</td><td>Math</td><td>2025-06-29</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  <script src="../js/sidebar.js"></script>
  <script>
    // Notification panel functionality (left side, dynamic, single instance)
    const notifBtn = document.getElementById('notification-btn');
    const notifPanel = document.getElementById('notification-panel');
    const closeNotifBtn = document.getElementById('close-notif-btn');
    const notifDot = document.getElementById('notif-dot');
    const notifList = document.getElementById('notif-list');
    const addNotifBtn = document.getElementById('add-notif-btn');
    const notifTitle = document.getElementById('notif-title');
    const notifMsg = document.getElementById('notif-msg');
    let notifOpen = false;
    let notifications = [
      {title: 'System Maintenance', date: 'July 7, 2025', msg: 'The portal will be down for maintenance from 10pm to 12am.'},
      {title: 'Convocation Reminder', date: 'August 1, 2025', msg: 'All final year students should check their emails for convocation details.'},
      {title: 'Sports Week', date: 'July 20, 2025', msg: 'Inter-faculty sports competitions start next week. Register with your faculty rep!'},
      {title: 'New Clubs Launch', date: 'September 5, 2025', msg: 'Join us for the launch of new student clubs and societies in the main auditorium.'}
    ];
    function renderNotifications() {
      notifList.innerHTML = '';
      if (notifications.length === 0) {
        notifList.innerHTML = '<div style="padding:18px;text-align:center;color:#888;">No notifications</div>';
        return;
      }
      notifications.forEach((n, i) => {
        const div = document.createElement('div');
        div.style.padding = '12px 18px';
        div.style.borderBottom = '1px solid #eee';
        div.innerHTML = `<b>${n.title}</b><br><span style='font-size:13px;color:#555;'>${n.date}</span><br><span style='font-size:14px;'>${n.msg}</span> <button onclick='removeNotif(${i})' style='float:right;background:none;border:none;color:#f44336;font-size:15px;cursor:pointer;' title='Remove'>&#10006;</button>`;
        notifList.appendChild(div);
      });
    }
    window.removeNotif = function(idx) {
      notifications.splice(idx, 1);
      renderNotifications();
      if(notifications.length === 0 && notifDot) notifDot.style.display = 'none';
    }
    if(notifBtn && notifPanel) {
      notifBtn.addEventListener('click', function(e) {
        e.preventDefault();
        notifPanel.style.display = notifOpen ? 'none' : 'block';
        notifOpen = !notifOpen;
        if(notifOpen && notifDot) notifDot.style.display = 'none';
        renderNotifications();
      });
    }
    if(closeNotifBtn && notifPanel) {
      closeNotifBtn.addEventListener('click', function() {
        notifPanel.style.display = 'none';
        notifOpen = false;
      });
    }
    // Add notification
    if(addNotifBtn && notifTitle && notifMsg) {
      addNotifBtn.addEventListener('click', function() {
        const title = notifTitle.value.trim();
        const msg = notifMsg.value.trim();
        if(title && msg) {
          const date = new Date().toLocaleDateString('en-US', {month:'long', day:'numeric', year:'numeric'});
          notifications.unshift({title, date, msg});
          notifTitle.value = '';
          notifMsg.value = '';
          renderNotifications();
          if(notifDot) notifDot.style.display = 'inline-block';
        }
      });
    }
    // Hide notification panel if clicked outside
    document.addEventListener('mousedown', function(e) {
      if(notifPanel && notifOpen && !notifPanel.contains(e.target) && e.target !== notifBtn) {
        notifPanel.style.display = 'none';
        notifOpen = false;
      }
    });
  </script>
  <script>
    // Manage Users Modal functionality
    const manageUsersModal = document.getElementById('manage-users-modal');
    const openManageUsersBtn = document.getElementById('open-manage-users-btn');
    const closeManageUsersBtn = document.getElementById('close-manage-users-btn');
    if(openManageUsersBtn && manageUsersModal) {
      openManageUsersBtn.addEventListener('click', function(e) {
        e.preventDefault();
        manageUsersModal.style.display = 'flex';
      });
    }
    if(closeManageUsersBtn && manageUsersModal) {
      closeManageUsersBtn.addEventListener('click', function() {
        manageUsersModal.style.display = 'none';
      });
    }
    // Toggle user status (block/unblock)
    window.toggleUserStatus = function(btn) {
      const row = btn.closest('tr');
      const statusCell = row.querySelector('td:nth-child(3) span');
      if(statusCell.textContent === 'Active') {
        statusCell.textContent = 'Blocked';
        statusCell.style.color = 'red';
        btn.textContent = 'Unblock';
      } else {
        statusCell.textContent = 'Active';
        statusCell.style.color = 'green';
        btn.textContent = 'Block';
      }
    }
  </script>
  <script>
    // WhatsApp-like chat modal functionality (front-end only, not persistent)
    const chatModal = document.getElementById('chat-modal');
    const openChatBtn = document.getElementById('open-chat-btn');
    const closeChatBtn = document.getElementById('close-chat-btn');
    const chatForm = document.getElementById('chat-form');
    const chatBox = document.getElementById('chat-box');
    if(openChatBtn && chatModal) {
      openChatBtn.addEventListener('click', function(e) {
        e.preventDefault();
        chatModal.style.display = 'flex';
      });
    }
    if(closeChatBtn && chatModal) {
      closeChatBtn.addEventListener('click', function() {
        chatModal.style.display = 'none';
      });
    }
    if(chatForm && chatBox) {
      chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const user = document.getElementById('chat-user').value.trim();
        const msg = document.getElementById('chat-msg').value.trim();
        if(user && msg) {
          const entry = document.createElement('div');
          entry.style.alignSelf = (user.toLowerCase().includes('lecturer')) ? 'flex-start' : 'flex-end';
          entry.style.maxWidth = '80%';
          entry.style.background = (user.toLowerCase().includes('lecturer')) ? '#fff' : '#dcf8c6';
          entry.style.color = '#222';
          entry.style.padding = '8px 12px';
          entry.style.borderRadius = '12px';
          entry.style.margin = '2px 0';
          entry.style.boxShadow = '0 1px 4px rgba(0,0,0,0.06)';
          entry.innerHTML = `<span style='font-size:13px;font-weight:600;color:#075e54;'>${user}</span><br>${msg}`;
          chatBox.appendChild(entry);
          chatBox.scrollTop = chatBox.scrollHeight;
          chatForm.reset();
        }
      });
    }
  </script>
  <script>
    function logoutRedirect() {
      window.location.href = '../role-selection.html';
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Chart.js example
    const ctx = document.getElementById('enrollmentChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'Enrollments',
          data: [12, 19, 8, 15, 10, 17],
          backgroundColor: '#3949ab'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 2.5,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
